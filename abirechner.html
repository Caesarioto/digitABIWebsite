
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Abi-Rechner – DigitABI</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap');
   :root{
      --grad-left:#FA565D; --grad-mid:#C45CAD; --grad-right:#9052F8; --ink:#151527;
      --paper:#f6f6f8; --card:#ffffff; --border:#6c50ff; --accent:#2e1df7; --accent-weak:#eae7ff;
      --link:rgba(255,255,255,.9);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:'Poppins',system-ui,Segoe UI,Roboto,Arial,sans-serif; color:#111;
      background:linear-gradient(100deg,var(--grad-left) 0%,var(--grad-mid) 50%,var(--grad-right) 100%);
      min-height:100vh; display:flex; flex-direction:column;
    }
    .container{
      max-width:min(1920px, 98vw);
      margin:0 auto;
      padding:32px 24px;
      flex:1;
      display:flex;
      flex-direction:column;
    }
    .frame{
      background:var(--paper);
      border:3px solid var(--border);
      border-radius:10px;
      padding: 25px 38px 25px;
      max-width:min(2400px, 98vw);
      margin:18px auto;
      box-shadow:0 8px 30px rgba(17,16,50,.18);
	font-size: 1.5em;
    }
    h1{margin:0 0 8px; text-align:center; font-size:clamp(25px,4vw,48px); font-weight:800; letter-spacing:.04em}
    .row{margin:18px 0}
    .options{display:flex; flex-wrap:wrap; gap:14px; justify-content:center}
    .opt{padding:14px 19px; border-radius:10px; border:2px solid #ddd; background:#fff; cursor:pointer; font-weight:600; min-width:192px; text-align:center}
    .opt.is-selected {
  background: #fff !important;      /* lila Hintergrund */
  border-color: #BA55D3 !important;    /* lila Rahmen */
}
    .choice{display:flex; align-items:center; gap:10px; padding:10px 12px; border:1px solid #ddd; border-radius:10px; background:#fff}
    .choice.disabled{opacity:0.5; pointer-events:none}
    .range-wrap{display:grid; gap:8px}
    .actions{display:flex; justify-content:space-between; gap:12px; margin-top:16px}
	.actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0 5px 0;   /* ← NEU: nur 5px Abstand unten statt 10px */
  margin-top: 0;
  margin-bottom: 0;
}
    .btn{display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:10px 25px; border-radius:12px; font-weight:700; text-decoration:none; cursor:pointer; border:2px solid transparent}
    .btn.prev{background:#fff; border-color:#cfd2ff; color:#1b1b2f}
    .btn.next {
  background: #BA55D3;      /* <-- HIER die neue Farbe eintragen */
  color: #fff;               /* Text bleibt weiß, damit es gut lesbar ist */
}
    .btn.next.ghost{background:var(--accent-weak); color:var(--accent); border-color:var(--accent)}
    .btn:disabled{opacity:.5; cursor:not-allowed}
    .summary{background:#fff; border:1px solid #e3e3e3; border-radius:12px; padding:16px; line-height:1.9}
    .summary b{font-weight:800}
    .step{display:none}
    .step.active{display:block}
    .footerlinks{
      display:flex; gap:28px; justify-content:center; color:#fff !important; font-weight:600; letter-spacing:.06em; padding:26px 0 18px; flex-wrap:wrap;
    }
    .footerlinks a{color:#fff !important; text-decoration:none}
    .footerlinks a:hover{text-decoration:underline; color:#eae7ff !important}
    :root{--container-w:1920px; --frame-w:1680px}
    body > .container{max-width:min(var(--container-w),98vw)!important}
    body > .container > .frame{max-width:min(var(--frame-w),96vw)!important}
    .step .row{text-align:center}
    .step .options, .step .range-wrap, .step .row[id="contentChecks"]{
      display:flex; justify-content:center; flex-wrap:wrap; gap:10px;
    }
    .step .choice{justify-content:center}
    /* === Nur im Inhalte-Step (Step 3) kleinere Schrift === */
.step[data-step="3"] .choice,
.step[data-step="3"] .choice input + * {
  font-size: 0.95rem !important;     /* ca. 15–16 px statt 24 px */
  line-height: 1.4 !important;
  padding: 11px 16px !important;     /* etwas weniger Innenabstand → kompakter */
}
    #summaryBox ul {
  list-style: none !important;     /* entfernt die Punkte */
  padding-left: 0 !important;      /* entfernt den linken Einzug */
  margin: 0 !important;
}
	      /* ===== TOPNAV + LOGIN-DIALOG (wie Startseite) ===== */
    .topnav{
      position:relative;
      display:flex;
      align-items:center;
      height:48px;
      padding:0 12px;
      font-weight:700;
      letter-spacing:.04em;
      color:#fff;
      font-family:'Poppins',system-ui,Segoe UI,Roboto,Arial,sans-serif;
    }
    .topnav .logo-link{
      display:flex;
      align-items:center;
      height:100%;
      margin-right:20px;
      text-decoration:none;
    }
    .topnav .nav-logo{
      height:36px;
      width:auto;
      object-fit:contain;
    }
    .topnav .nav-links{
      display:flex;
      justify-content:center;
      align-items:center;
      gap:28px;
      flex:1;
    }
    .topnav .nav-links a{
      color:var(--link);
      text-decoration:none;
      white-space:nowrap;
    }
    .topnav .nav-links a:hover{ text-decoration:underline; }

    .topnav .authbox{
      position:absolute;
      right:12px;
      top:50%;
      transform:translateY(-50%);
      display:flex;
      align-items:center;
      gap:10px;
    }
    .topnav .btn{
      padding:7px 10px;
      border-radius:10px;
      border:2px solid rgba(255,255,255,.9);
      background:transparent;
      color:#fff;
      font-weight:800;
      cursor:pointer;
      font-size:13px;
    }
    .topnav .btn:hover{ background:rgba(255,255,255,.15); }
    #userEmail{ color:#fff; font-weight:700; font-size:14px; }

    [data-requires-auth]{ display:none; }
    [data-requires-anon]{ display:inline-flex; }

    dialog{
      border:none;
      border-radius:16px;
      padding:0;
      width:min(420px,92vw);
      background:#fff;
      color:#111;
      box-shadow:0 25px 80px rgba(0,0,0,.5);
    }
    dialog::backdrop{
      background:rgba(0,0,0,.45);
      backdrop-filter:blur(3px);
    }
    dialog form{
      padding:26px 22px;
      font-family:inherit;
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    dialog label{
      display:grid;
      gap:6px;
      margin-bottom:12px;
      font-weight:600;
      color:#222;
    }
    dialog input{
      padding:10px 12px;
      border-radius:8px;
      border:1px solid #ccc;
      font:inherit;
    }
    dialog button[type="submit"]{
      padding:10px 14px;
      border-radius:10px;
      border:2px solid #2e1df7;
      background:#eae7ff;
      color:#2e1df7;
      font-weight:700;
      cursor:pointer;
    }
    #authMessage{ margin-top:10px; color:#333; font-weight:600; }
  </style>
</head>
<body>
   <header>
    <nav class="topnav" aria-label="Hauptnavigation">
      <a href="index.html" class="logo-link" aria-label="DigitABI Startseite">
        <img src="assets/place-holder.png"
             onerror="this.src='assets/logo-digitabi.png'; this.onerror=null;"
             alt=""
             class="nav-logo">
      </a>

      <div class="nav-links">
        <a href="index.html">Startseite</a>
        <a href="abirechner.html">Abibuch-Creator</a>
        <a href="steckbrief.html">Abibuch-Editor</a>
        <a href="index.html#mottos">Motto-Ideen</a>
        <a href="ueber-uns.html">Über Uns</a>
        <a href="konto.html" data-requires-auth>Mein Konto</a>
      </div>

      <div class="authbox">
        <span id="userEmail" data-requires-auth></span>
        <button id="logoutBtn" class="btn" data-requires-auth>Logout</button>
        <button class="btn" data-requires-anon data-action="open-auth">Login / Registrieren</button>
      </div>
    </nav>

    <!-- Login / Registrieren Modal -->
    <dialog id="authModal">
      <form id="authForm" method="dialog">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
          <strong style="font-size:18px">Einloggen / Registrieren</strong>
          <button type="button" id="closeAuth"
                  style="background:#eee;border:none;border-radius:8px;padding:6px 10px">✕</button>
        </div>
        <p style="margin:8px 0 12px;color:#333">
          E-Mail eingeben – wir senden dir einen Magic-Link.
        </p>
        <label>
          E-Mail
          <input name="email" type="email" required placeholder="du@example.com">
        </label>
        <button type="submit"
                style="width:100%;padding:12px 14px;border-radius:12px;border:2px solid #2e1df7;background:#eae7ff;color:#2e1df7;font-weight:800;">
          Magic-Link senden
        </button>
        <div id="authMessage"></div>
      </form>
    </dialog>
  </header>

  <div class="container" style="max-width:1920px!important;width:100%!important">
    <div class="frame" id="rechner" style="max-width:1680px!important">
      <h1>Mein Abibuch-Creator</h1>

      <!-- STEP 0: Jahr -->
      <section class="step active" data-step="0">
        <div class="row">
          <p class="mb-4" style="font-size:18px;font-weight:700">Für welches Jahr ist dein Abibuch?</p>
          <div class="options" id="yearOptions">
            <button class="opt" data-value="2025">2025</button>
            <button class="opt is-selected" data-value="2026">2026</button>
            <button class="opt" data-value="2027">2027</button>
          </div>
        </div>
        <div class="actions">
          <button class="btn prev" disabled>Zurück</button>
          <button class="btn next">Weiter</button>
        </div>
      </section>

      <!-- STEP 1: Personen -->
      <section class="step" data-step="1">
        <div class="row">
          <p class="mb-4" style="font-size:18px;font-weight:700">Wie viele Personen sollen ein Abibuch bekommen?</p>
          <div class="range-wrap">
            <input id="personsRange" type="range" min="1" max="170" value="85">
            <div style="text-align:center;font-size:18px;font-weight:700"><span id="personsOut">85</span> Personen</div>
          </div>
        </div>
        <div class="actions">
          <button class="btn prev">Zurück</button>
          <button class="btn next">Weiter</button>
        </div>
      </section>

      <!-- STEP 2: Digital? -->
      <section class="step" data-step="2">
        <div class="row">
          <p class="mb-4" style="font-size:18px;font-weight:700">Möchtest du eine digitale Version deines Abibuchs?</p>
          <div class="options" id="digitalOptions">
            <button class="opt is-selected" data-value="Ja">Ja</button>
            <button class="opt" data-value="Nein">Nein</button>
            <button class="opt" data-value="Nur digital">Nur digital</button>
          </div>
        </div>
        <div class="actions">
          <button class="btn prev">Zurück</button>
          <button class="btn next">Weiter</button>
        </div>
      </section>

      <!-- STEP 3: Inhalte -->
      <section class="step" data-step="3">
        <div class="row">
          <p class="mb-4" style="font-size:18px;font-weight:700">Welche Inhalte möchtest du in deinem Abibuch?</p>
          <div class="row" id="contentChecks" style="display:grid;gap:8px">
            <label class="choice"><input type="checkbox" value="Lehrer-Steckbriefe"> Lehrer-Steckbriefe</label>
            <label class="choice"><input type="checkbox" value="Schüler-Steckbriefe"> Schüler-Steckbriefe</label>
            <label class="choice"><input type="checkbox" value="Fotos"> Fotos</label>
            <label class="choice"><input type="checkbox" value="Schüler-Rankings"> Schüler-Rankings</label>
            <label class="choice"><input type="checkbox" value="Lehrer-Rankings"> Lehrer-Rankings</label>
            <label class="choice" data-type="digital-only"><input type="checkbox" value="Videos"> Videos</label>
            <label class="choice" data-type="digital-only"><input type="checkbox" value="Sprachmemos" checked> Sprachmemos</label>
          </div>
        </div>
        <div class="actions">
          <button class="btn prev">Zurück</button>
          <button class="btn next">Weiter</button>
        </div>
      </section>

      <!-- STEP 4: Speicherplatz -->
      <section class="step" data-step="4">
        <div class="row">
          <p class="mb-4" style="font-size:18px;font-weight:700">Wie viel Speicherplatz benötigst du für deine digitale Version?</p>
          <div class="options" id="storageOptions">
            <button class="opt" data-value="Basic (5 GB)">Basic (5 GB)</button>
            <button class="opt is-selected" data-value="Plus (25 GB)">Plus (25 GB)</button>
            <button class="opt" data-value="Premium (50 GB)">Premium (50 GB)</button>
          </div>
        </div>
        <div class="actions">
          <button class="btn prev">Zurück</button>
          <button class="btn next">Weiter</button>
        </div>
      </section>

      <!-- STEP 5: Format (wird bei "Nur digital" übersprungen!) -->
      <section class="step" data-step="5">
        <div class="row">
          <p class="mb-4" style="font-size:18px;font-weight:700">Welches Format soll dein Abibuch haben?</p>
          <div class="options" id="sizeOptions">
            <button class="opt is-selected" data-value="DIN A4">DIN A4 (210×297 mm)</button>
            <button class="opt" data-value="Buchformat">Buchformat (170×210 mm)</button>
          </div>
        </div>
        <div class="actions">
          <button class="btn prev">Zurück</button>
          <button class="btn next">Weiter</button>
        </div>
      </section>

      <!-- STEP 6: Cover (wird bei "Nur digital" übersprungen!) -->
      <section class="step" data-step="6">
        <div class="row">
          <p class="mb-4" style="font-size:18px;font-weight:700">Welche Art von Cover soll dein Abibuch haben?</p>
          <div class="options" id="coverOptions">
            <button class="opt is-selected" data-value="Hard-Cover">Hard-Cover</button>
            <button class="opt" data-value="Soft-Cover">Soft-Cover</button>
          </div>
        </div>
        <div class="actions">
          <button class="btn prev">Zurück</button>
          <button class="btn next">Weiter</button>
        </div>
      </section>

      <!-- STEP 7: Zusammenfassung -->
      <section class="step" data-step="7">
        <div class="row">
          <p class="mb-2" style="font-size:18px;font-weight:700">Zusammenfassung deiner Auswahl:</p>
          <div class="summary" id="summaryBox"></div>
        </div>
        <div class="actions">
          <button class="btn prev">Zurück</button>
          <button class="btn next ghost" id="priceBtn">Preis berechnen</button>
        </div>
      </section>
    </div>
    <footer class="footerlinks">
      <a href="kontakt.html">Kontakt</a>
      <a href="impressum.html">Impressum</a>
      <a href="nutzungsbedingungen.html">Nutzungsbedingungen</a>
      <a href="datenschutz.html">Datenschutz</a>
      <a href="rechtliche-hinweise.html">Rechtliche Hinweise</a>
    </footer>
  </div>
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    const SUPABASE_URL = "https://YOUR-PROJECT.supabase.co";   // <- deine URL
    const SUPABASE_ANON_KEY = "YOUR-ANON-KEY";                 // <- dein anon key

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const authModal = document.getElementById("authModal");

    async function loadProfileName(session){
      if(!session?.user) return "";
      const { data } = await supabase
        .from("profiles")
        .select("display_name")
        .eq("id", session.user.id)
        .maybeSingle();
      return data?.display_name || session.user.email;
    }

    async function updateAuthUI(session){
      const isLoggedIn = !!session?.user;
      document.querySelectorAll("[data-requires-auth]")
        .forEach(el => el.style.display = isLoggedIn ? "" : "none");
      document.querySelectorAll("[data-requires-anon]")
        .forEach(el => el.style.display = isLoggedIn ? "none" : "");

      const span = document.getElementById("userEmail");
      if(span) span.textContent = isLoggedIn ? await loadProfileName(session) : "";
    }

    // Initialstatus
    const { data: init } = await supabase.auth.getSession();
    await updateAuthUI(init.session);
    supabase.auth.onAuthStateChange((_e, session) => updateAuthUI(session));

    // Login
    async function signInWithEmail(e){
      e.preventDefault();
      const msg = document.getElementById("authMessage");
      const email = e.currentTarget.querySelector('input[name="email"]').value.trim();
      if(!email){ msg.textContent = "Bitte E-Mail eingeben."; return; }

      const { error } = await supabase.auth.signInWithOtp({
        email,
        options: { emailRedirectTo: window.location.origin }
      });
      msg.textContent = error ? ("Fehler: " + error.message)
                              : "Magic-Link gesendet. Bitte Postfach prüfen ✉️";
    }

    document.getElementById("authForm")?.addEventListener("submit", signInWithEmail);
    document.getElementById("logoutBtn")?.addEventListener("click", () => supabase.auth.signOut());
    document.querySelectorAll("[data-action='open-auth']").forEach(btn =>
      btn.addEventListener("click", () => authModal.showModal())
    );
    document.getElementById("closeAuth")?.addEventListener("click", () => authModal.close());
  </script>

  <script>
    // --- State ---
    const form = {
      year: 2026,
      persons: 85,
      digital_option: "Ja",
      storage: "Plus (25 GB)",
      content: ["Sprachmemos"],
      size: "DIN A4",
      cover: "Hard-Cover"
    };
    let step = 0;

    // --- Elements ---
    const steps = [...document.querySelectorAll('.step')];
    const personsRange = document.getElementById('personsRange');
    const personsOut = document.getElementById('personsOut');
    const yearOpts = document.getElementById('yearOptions');
    const digitalOpts = document.getElementById('digitalOptions');
    const contentChecks = document.getElementById('contentChecks');
    const summaryBox = document.getElementById('summaryBox');
    const step3NextBtn = steps[3].querySelector('.btn.next');
    const storageOpts = document.getElementById('storageOptions');
    const sizeOpts = document.getElementById('sizeOptions');
    const coverOpts = document.getElementById('coverOptions');

    // --- Digital-only Inhalte ---
    const digitalOnlyLabels = contentChecks.querySelectorAll('.choice[data-type="digital-only"]');
    const digitalOnlyInputs = [...digitalOnlyLabels].map(l => l.querySelector('input'));

    // --- Update digital-only checkboxes ---
    function updateDigitalOnly() {
      const isDisabled = form.digital_option === "Nein";
      digitalOnlyLabels.forEach(label => {
        label.classList.toggle('disabled', isDisabled);
      });
      digitalOnlyInputs.forEach(input => {
        input.disabled = isDisabled;
        if (isDisabled && input.checked) {
          input.checked = false;
        }
      });
      form.content = [...contentChecks.querySelectorAll('input[type="checkbox"]:checked')].map(c => c.value);
      updateContentNextButton();
    }

    // --- Navigation ---
    function showStep(n) {
      steps.forEach(s => s.classList.remove('active'));
      steps[n].classList.add('active');
      step = n;
      if (step === 7) renderSummary();
      if (step === 3) {
        updateDigitalOnly();
        updateContentNextButton();
      }
    }

    function nextStep() {
      if (step === 2) {
        return showStep(3); // Immer zu Inhalte
      }
      if (step === 3) {
        if (form.digital_option === "Nur digital") return showStep(4); // → Speicher
        if (form.digital_option === "Ja") return showStep(4);         // → Speicher
        if (form.digital_option === "Nein") return showStep(5);       // → Format
      }
      if (step === 4) {
        if (form.digital_option === "Nur digital") return showStep(7); // → direkt Zusammenfassung
        return showStep(5); // → Format (bei Ja/Nein)
      }
      if (step === 5) {
        return showStep(6); // → Cover (nur bei Ja/Nein)
      }
      if (step === 6) return showStep(7);
      return showStep(Math.min(step + 1, 7));
    }

    function prevStep() {
      if (step === 7) {
        if (form.digital_option === "Nur digital") return showStep(4); // Speicher
        if (form.digital_option === "Ja") return showStep(6);          // Cover
        if (form.digital_option === "Nein") return showStep(5);        // Format
      }
      if (step === 6) return showStep(5);
      if (step === 5) {
        if (form.digital_option === "Nein") return showStep(3);
        return showStep(4);
      }
      if (step === 4) return showStep(3);
      if (step === 3) return showStep(2);
      return showStep(Math.max(step - 1, 0));
    }

    function renderSummary() {
      const items = [
        ["Jahr", form.year],
        ["Personen", form.persons],
        ["Digital", form.digital_option],
        ["Inhalte", form.content.length ? form.content.join(', ') : "—"],
        ["Speicherplatz", form.digital_option === "Nur digital" || form.digital_option === "Ja" ? form.storage : "—"],
        ["Buchgröße", form.digital_option === "Nur digital" ? "—" : form.size],
        ["Cover", form.digital_option === "Nur digital" ? "—" : form.cover],
      ];
      summaryBox.innerHTML = "<ul style='margin:0;padding-left:18px'>" +
        items.map(([k,v]) => `<li><b>${k}:</b> ${v}</li>`).join("") + "</ul>";
    }

    function updateContentNextButton() {
      if (step3NextBtn) {
        step3NextBtn.disabled = form.content.length === 0;
      }
    }

    // --- Events ---
    document.querySelectorAll('.btn.next').forEach(btn => btn.addEventListener('click', nextStep));
    document.querySelectorAll('.btn.prev').forEach(btn => btn.addEventListener('click', prevStep));

    personsRange.addEventListener('input', e => {
      form.persons = parseInt(e.target.value, 10);
      personsOut.textContent = form.persons;
    });

    yearOpts.addEventListener('click', e => {
      if (e.target.closest('.opt')) {
        yearOpts.querySelectorAll('.opt').forEach(b => b.classList.remove('is-selected'));
        const b = e.target.closest('.opt'); b.classList.add('is-selected');
        form.year = parseInt(b.dataset.value, 10);
      }
    });

    digitalOpts.addEventListener('click', e => {
      if (e.target.closest('.opt')) {
        digitalOpts.querySelectorAll('.opt').forEach(b => b.classList.remove('is-selected'));
        const b = e.target.closest('.opt'); b.classList.add('is-selected');
        form.digital_option = b.dataset.value;
        if (step === 3) updateDigitalOnly();
      }
    });

    storageOpts.addEventListener('click', e => {
      if (e.target.closest('.opt')) {
        storageOpts.querySelectorAll('.opt').forEach(b => b.classList.remove('is-selected'));
        const b = e.target.closest('.opt'); b.classList.add('is-selected');
        form.storage = b.dataset.value;
      }
    });

    sizeOpts.addEventListener('click', e => {
      if (e.target.closest('.opt')) {
        sizeOpts.querySelectorAll('.opt').forEach(b => b.classList.remove('is-selected'));
        const b = e.target.closest('.opt'); b.classList.add('is-selected');
        form.size = b.dataset.value;
      }
    });

    coverOpts.addEventListener('click', e => {
      if (e.target.closest('.opt')) {
        coverOpts.querySelectorAll('.opt').forEach(b => b.classList.remove('is-selected'));
        const b = e.target.closest('.opt'); b.classList.add('is-selected');
        form.cover = b.dataset.value;
      }
    });

    contentChecks.addEventListener('change', () => {
      form.content = [...contentChecks.querySelectorAll('input[type="checkbox"]:checked')].map(c => c.value);
      updateContentNextButton();
    });

    document.getElementById('priceBtn').addEventListener('click', () => {
      alert('Preisberechnung folgt – Logik wird noch hinterlegt.');
    });

    // --- INIT ---
    updateContentNextButton();
  </script>
</body>
</html>


