<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Steckbrief – Vorschau | DigitABI</title>
  <style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap');
  :root{ --grad-left:#FA565D; --grad-mid:#C45CAD; --grad-right:#9052F8; --ink:#151527; --muted:rgba(0,0,0,.62); --vio:#BEB3FF; --vio-dark:#9e90ff; }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:'Poppins',system-ui,Segoe UI,Roboto,Arial,sans-serif; color:#111;
    background:linear-gradient(100deg,var(--grad-left) 0%,var(--grad-mid) 50%,var(--grad-right) 100%);
    min-height:100vh; display:flex; flex-direction:column;
  }
  .container{max-width:1180px;margin:0 auto;padding:32px 24px;flex:1;display:flex;flex-direction:column}
  .nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
  .nav .left,.nav .right{display:flex;gap:18px;align-items:center}
  .brand{font-weight:800; letter-spacing:.02em;color:#fff}
  .smallcaps{text-transform:uppercase; letter-spacing:.08em; font-weight:600}
  .nav a{color:rgba(255,255,255,.88);text-decoration:none; font-weight:600}
  .nav a:hover{text-decoration:underline}

  .frame{
    background:#f6f6f8; border:3px solid #6c50ff; border-radius:8px;
    padding:28px 24px; max-width:860px; margin:16px auto; position:relative;
    box-shadow:0 8px 30px rgba(17,16,50,.18);
  }
  .frame h2{ text-align:center; margin:0; line-height:1.35; color:#1f1f2f; }
  .frame h2 .line2{font-weight:800}

  .sheet{ margin-top:18px; background:#f6f6f8; border:1px solid #b6a8ff; border-radius:10px; padding:24px 22px; }
  .photos{display:grid; grid-template-columns: 140px 1fr 140px; gap:24px; align-items:start; margin-top:6px}

  /* Foto-Platzhalter / Upload-Zonen */
  .ph{
    position:relative;
    height:160px; border-radius:10px;
    background:var(--vio);
    display:flex; align-items:center; justify-content:center; font-weight:700; color:#3b2f77;
    overflow:hidden;
  }
  .ph[data-has-img="true"]{
    background-size:cover;
    background-position:center;
    color:transparent; /* Text ausblenden, wenn Bild vorhanden */
  }
  .ph input[type="file"]{ display:none; }
  .ph .overlay{
    position:absolute; left:8px; bottom:8px;
    display:flex; gap:6px;
  }
  .tinybtn{
    font:inherit; font-weight:700; padding:6px 8px; border-radius:10px; cursor:pointer;
    border:2px solid #cfd2ff; background:#fff; color:#1b1b2f; font-size:12px;
  }
  .tinybtn.primary{ border-color:#2e1df7; background:#eae7ff; color:#2e1df7 }

  .name{ display:flex; flex-direction:column; align-items:center; justify-content:center; padding-top:10px; }
  .name .big{font-size:20px; font-weight:700; letter-spacing:.02em; color:#111; text-align:center}
  .name .date{font-size:12.5px; color:#333}

  .facts{margin-top:18px; display:grid; grid-template-columns:1fr; gap:10px}
  .row{display:grid; grid-template-columns: 240px 1fr; gap:10px; align-items:baseline}
  .label{color:#333; font-weight:600; position:relative; padding-right:22px}
  .value{color:#111}
  .muted{color:var(--muted); font-weight:600}
  .spacer{height:10px}

  /* kleine, dezente Editorleiste */
  .custombar{
    display:flex; gap:8px; align-items:center; justify-content:flex-end;
    margin-top:8px; margin-bottom:4px;
  }
  .microbtn{
    font:inherit; font-weight:700; padding:6px 10px; border-radius:10px; cursor:pointer;
    border:2px solid #cfd2ff; background:#fff; color:#1b1b2f;
  }
  .microbtn.primary{ border-color:#2e1df7; background:#eae7ff; color:#2e1df7 }
  .customform{ display:none; gap:8px; grid-template-columns:240px 1fr auto; align-items:center; margin:8px 0 2px }
  .customform input{
    width:100%; padding:8px 10px; border:1px solid #ddd; border-radius:10px; font-family:inherit;
  }

  /* Entfernen-Button im Label (für Basis & Custom identisch) */
  .remove{
    position:absolute; right:0; top:2px; border:0; background:transparent; color:#777; cursor:pointer; font-weight:800;
  }
  .remove:hover{ color:#c00 }
  .show{ display:grid !important; }

  .next{
    display:inline-flex; align-items:center; justify-content:center;
    padding:10px 16px; font-weight:700; border-radius:12px;
    border:2px solid #2e1df7; background:#eae7ff; text-decoration:none; color:#2e1df7;
    position:absolute; right:18px; bottom:14px;
  }
  .next:hover{background:#dcd6ff}

  footer.footerlinks{display:flex; gap:16px; justify-content:center; margin-top:22px}
  footer.footerlinks a{color:#fff; text-decoration:none; font-weight:600}
  footer.footerlinks a:hover{text-decoration:underline}
  </style>
</head>
<body>

<!-- Top-Leiste als IFRAME einbinden -->
<iframe src="topnav.html" title="Navigation" class="topnav-embed"></iframe>
<style>
  .topnav-embed{
    width:100%; height:48px; border:0; display:block; overflow:hidden;
    background:transparent;
  }
</style>

  <div class="container">
    <div class="frame">
      <h2 class="smallcaps">Vorschau unseres Abibuch-Editors<br><span class="line2">– so könnte dein Abibuch aussehen:</span></h2>

      <div class="sheet">
        <div class="photos">
          <!-- AKTUELLES FOTO -->
          <label class="ph" id="photo-current" data-has-img="false" title="Klicken zum Bild hochladen">
            <input type="file" id="file-current" accept="image/*">
            <span>AKTUELLES FOTO</span>
            <div class="overlay">
              <button type="button" class="tinybtn primary" data-action="select" data-target="current">Bild wählen</button>
              <button type="button" class="tinybtn" data-action="clear" data-target="current">Bild löschen</button>
            </div>
          </label>

          <div class="name">
            <div class="big">Mulan<br>Mustermann</div>
            <div class="date">31.02.2008</div>
          </div>

          <!-- KINDERBILD -->
          <label class="ph" id="photo-child" data-has-img="false" title="Klicken zum Bild hochladen">
            <input type="file" id="file-child" accept="image/*">
            <span>KINDERBILD</span>
            <div class="overlay">
              <button type="button" class="tinybtn primary" data-action="select" data-target="child">Bild wählen</button>
              <button type="button" class="tinybtn" data-action="clear" data-target="child">Bild löschen</button>
            </div>
          </label>
        </div>

        <!-- kleine Editorleiste -->
        <div class="custombar">
          <button class="microbtn primary" id="toggleCustom">+ Eigenes Feld</button>
          <button class="microbtn" id="clearCustom">Benutzerfelder löschen</button>
          <button class="microbtn" id="resetBase">Standardfelder zurücksetzen</button>
        </div>

        <!-- Eingabeformular für neue Felder (eingeklappt) -->
        <div class="customform" id="customForm">
          <input id="cfLabel" type="text" placeholder="Feldtitel (z. B. Lieblingsessen)">
          <input id="cfValue" type="text" placeholder="Inhalt (z. B. Pizza)">
          <button class="microbtn primary" id="cfAdd">Hinzufügen</button>
        </div>

        <!-- Faktenliste (Standard + Benutzerfelder) -->
        <div class="facts" id="facts"><!-- per JS --></div>

        <a class="next smallcaps" href="steckbrief-seite-2.html">→ Seite 2</a>
      </div>
    </div>

    <footer class="footerlinks">
      <a href="kontakt.html">Kontakt</a>
      <a href="impressum.html">Impressum</a>
      <a href="nutzungsbedingungen.html">Nutzungsbedingungen</a>
      <a href="datenschutz.html">Datenschutz</a>
      <a href="rechtliche-hinweise.html">Rechtliche Hinweise</a>
    </footer>
  </div>

  <script>
    /* ===== Basisfelder mit stabilen IDs ===== */
    const BASE_FIELDS = [
      { id:"leistungskurse", label:"Leistungskurse:", value:"Bio, Sport" },
      { id:"lieblingsfach", label:"Lieblingsfach:", value:"Bio, Sport" },
      { id:"hassfach", label:"Hassfach:", value:"alle anderen" },
      { id:"lieblingslehrer", label:"Lieblingslehrer:", value:"Frau Himmelmann" },
      { id:"hasslehrer", label:"Hasslehrer:", value:"Herr Bock" },
      { id:"sportart", label:"Meine Sportart:", value:"Pausenhofschlägerei" },
      { id:"beschaeftigung", label:"Lieblingsbeschäftigung im Unterricht:", value:"Nase popeln" },
      { id:"motivationslevel", label:"Motivationslevel in der Schule:", value:"unterirdisch, -2/10" },
      { id:"drei-dinge", label:"3 Dinge, ohne die ich die Schule nicht überlebt hätte:", value:"Zigarettenpause, Handy, Freunde" },
      { id:"als-lehrer", label:"Als Lehrer würde ich...", value:"den Beruf wechseln" },
      { id:"rat-fuenft", label:"Fünft-Klässlern würde ich raten...", value:"lieber einen Hauptschulabschluss zu machen" },
      { id:"bestes-erlebnis", label:"Bestes Schulerlebnis:", value:"eine Woche Hitzefrei in der zehnten Klasse" },
      { id:"dreier-worte-head", label:"Die ersten 3 Worte die mir einfallen, wenn ich ... höre:", value:"" },
      { id:"dreier-worte-schule", label:"Schule:", value:"boah ne ey" },
      { id:"dreier-worte-freunde", label:"Freunde:", value:"Schabernack letzte Reihe" },
      { id:"dreier-worte-alkohol", label:"Alkohol:", value:"gib die Flasche!" },
      { id:"mein-vorbild", label:"Mein Vorbild:", value:"Mia Khalifa" },
      { id:"plan-nach-abi", label:"Plan nach dem Abi:", value:"erst mal chillen" },
      { id:"mein-traumberuf", label:"Mein Traumberuf:", value:"OnlyFans-Model" },
      { id:"in-zehn-jahren", label:"Da sehe ich mich in 10 Jahren:", value:"entspannt am Strand" },
      { id:"lotto-gewinn", label:"Wenn ich im Lotto gewinne, würde ich:", value:"ein Haus auf Hawaii kaufen" },
      { id:"autobiografie", label:"Titel meiner Autobiografie:", value:"es kann nur besser werden!" },
      { id:"abschluss", label:"Das möchte ich abschließend noch sagen:", value:"vielen Dank für die schöne Zeit und auf nimmer Wiedersehen },
    ];

    /* ===== Persistenz für Felder ===== */
    const CUSTOM_KEY   = "digitabiCustomFieldsV1";
    const DELETED_KEY  = "digitabiDeletedBaseV1";

    function loadCustom(){ try { return JSON.parse(localStorage.getItem(CUSTOM_KEY)) || []; } catch { return []; } }
    function saveCustom(list){ localStorage.setItem(CUSTOM_KEY, JSON.stringify(list)); }

    function loadDeleted(){ try { return new Set(JSON.parse(localStorage.getItem(DELETED_KEY)) || []); } catch { return new Set(); } }
    function saveDeleted(set){ localStorage.setItem(DELETED_KEY, JSON.stringify([...set])); }

    let customFields = loadCustom();      // [{label, value}]
    let deletedBase  = loadDeleted();     // Set(['hassfach', ...])

    /* ===== Persistenz & Logik für Bilder ===== */
    const IMG_KEY_CURRENT = "digitabiPhotoCurrentV1";
    const IMG_KEY_CHILD   = "digitabiPhotoChildV1";

    function setPhoto(el, dataUrl){
      if (!el) return;
      if (dataUrl){
        el.style.backgroundImage = `url('${dataUrl}')`;
        el.setAttribute("data-has-img", "true");
      }else{
        el.style.backgroundImage = "none";
        el.setAttribute("data-has-img", "false");
      }
    }

    function loadImages(){
      setPhoto(document.getElementById('photo-current'), localStorage.getItem(IMG_KEY_CURRENT));
      setPhoto(document.getElementById('photo-child'),   localStorage.getItem(IMG_KEY_CHILD));
    }

    function handleFile(inputEl, key, targetEl){
      const file = inputEl.files && inputEl.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        const dataUrl = reader.result;
        localStorage.setItem(key, dataUrl);
        setPhoto(targetEl, dataUrl);
      };
      reader.readAsDataURL(file);
    }

    /* ===== Render der Faktenliste ===== */
    const factsEl = document.getElementById("facts");

    function rowBaseHTML(f){
      const optClass = f.class ? ` ${f.class}` : "";
      return `
        <div class="row${optClass}">
          <div class="label">${f.label}<button class="remove" title="Feld entfernen" data-type="base" data-id="${f.id}">×</button></div>
          <div class="value">${f.value}</div>
        </div>
      `;
    }
    function rowCustomHTML(f, i){
      return `
        <div class="row">
          <div class="label">${f.label}<button class="remove" title="Feld entfernen" data-type="custom" data-i="${i}">×</button></div>
          <div class="value">${f.value}</div>
        </div>
      `;
    }

    function renderFacts(){
      let html = "";

      // Basisfelder, ausgelassene (gelöschte) überspringen
      for (const f of BASE_FIELDS){
        if (deletedBase.has(f.id)) continue;
        html += rowBaseHTML(f);
        if (f.id === "dreier-worte-head"){
          html += `<div class="spacer"></div>`;
        }
      }

      // Custom-Felder
      for (let i=0; i<customFields.length; i++){
        html += rowCustomHTML(customFields[i], i);
      }

      factsEl.innerHTML = html;
    }

    renderFacts();
    loadImages();

    /* ===== UI: hinzufügen / löschen / reset ===== */
    const toggleBtn = document.getElementById("toggleCustom");
    const clearBtn  = document.getElementById("clearCustom");
    const resetBtn  = document.getElementById("resetBase");
    const formBox   = document.getElementById("customForm");
    const addBtn    = document.getElementById("cfAdd");
    const inLabel   = document.getElementById("cfLabel");
    const inValue   = document.getElementById("cfValue");

    toggleBtn.addEventListener("click", () => {
      formBox.classList.toggle("show");
      if (formBox.classList.contains("show")) inLabel.focus();
    });

    addBtn.addEventListener("click", () => {
      const label = inLabel.value.trim();
      const value = inValue.value.trim();
      if (!label || !value){ alert("Bitte Feldtitel und Inhalt eingeben."); return; }
      customFields.push({ label, value });
      saveCustom(customFields);
      inLabel.value = ""; inValue.value = "";
      renderFacts();
    });

    clearBtn.addEventListener("click", () => {
      if (!customFields.length) return;
      if (!confirm("Alle eigenen Felder wirklich löschen?")) return;
      customFields = [];
      saveCustom(customFields);
      renderFacts();
    });

    resetBtn.addEventListener("click", () => {
      if (!deletedBase.size) return;
      if (!confirm("Alle Standardfelder wiederherstellen?")) return;
      deletedBase = new Set();
      saveDeleted(deletedBase);
      renderFacts();
    });

    // Delegation für alle ×-Buttons (Basis & Custom)
    factsEl.addEventListener("click", (e)=>{
      const btn = e.target.closest(".remove"); if (!btn) return;
      const type = btn.dataset.type;

      if (type === "custom"){
        const i = parseInt(btn.dataset.i, 10);
        customFields.splice(i, 1);
        saveCustom(customFields);
        renderFacts();
        return;
      }
      if (type === "base"){
        const id = btn.dataset.id;
        deletedBase.add(id);
        saveDeleted(deletedBase);
        renderFacts();
        return;
      }
    });

    /* ===== Foto-Upload Events ===== */
    const currentLabel = document.getElementById('photo-current');
    const childLabel   = document.getElementById('photo-child');
    const inputCurrent = document.getElementById('file-current');
    const inputChild   = document.getElementById('file-child');

    // Klick auf die Fläche öffnet Filepicker (außer Klick auf Buttons)
    currentLabel.addEventListener('click', (e)=>{
      if (e.target.closest('.tinybtn')) return;
      inputCurrent.click();
    });
    childLabel.addEventListener('click', (e)=>{
      if (e.target.closest('.tinybtn')) return;
      inputChild.click();
    });

    inputCurrent.addEventListener('change', ()=> handleFile(inputCurrent, IMG_KEY_CURRENT, currentLabel));
    inputChild.addEventListener('change',   ()=> handleFile(inputChild,   IMG_KEY_CHILD,   childLabel));

    // Buttons in der Overlay-Leiste
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('.tinybtn'); if(!btn) return;
      const action = btn.dataset.action;
      const target = btn.dataset.target; // "current" | "child"
      const isCurrent = target === 'current';
      const key  = isCurrent ? IMG_KEY_CURRENT : IMG_KEY_CHILD;
      const node = isCurrent ? currentLabel : childLabel;
      const inp  = isCurrent ? inputCurrent : inputChild;

      if (action === 'select'){
        inp.click();
      }
      if (action === 'clear'){
        localStorage.removeItem(key);
        setPhoto(node, null);
      }
    });
  </script>
</body>
</html>
