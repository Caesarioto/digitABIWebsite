
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Steckbrief – Vorschau | DigitABI</title>
  <style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap');
  :root{ --grad-left:#FA565D; --grad-mid:#C45CAD; --grad-right:#9052F8; --ink:#151527; --muted:rgba(0,0,0,.62); --vio:#BEB3FF; --vio-dark:#9e90ff; }
  *{box-sizing:border-box}
  /* ==================== FIX: FLÜSSIGER GRADIENT ==================== */
    html {
      min-height: 100%;
      height: 100%;
      background: linear-gradient(100deg, var(--grad-left) 0%, var(--grad-mid) 50%, var(--grad-right) 100%) fixed no-repeat;
      background-size: cover;
      background-position: center;
    }

    body {
      margin: 0;
      font-family: 'Poppins', system-ui, Segoe UI, Roboto, Arial, sans-serif;
      color: #fff;
      background: transparent;               /* WICHTIG: body ist jetzt transparent */
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    /* ==================== ENDE FIX ==================== */
  .container{max-width:1180px;margin:0 auto;padding:32px 24px;flex:1;display:flex;flex-direction:column}
  .nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
  .nav .left,.nav .right{display:flex;gap:18px;align-items:center}
  .brand{font-weight:800; letter-spacing:.02em;color:#fff}
  .smallcaps{text-transform:uppercase; letter-spacing:.08em; font-weight:600}
  .nav a{color:rgba(255,255,255,.88);text-decoration:none; font-weight:600}
  .nav a:hover{text-decoration:underline}
  h3.section{margin:22px 0 8px; text-align:center; text-decoration:underline; font-weight:700}
  .comment{margin-top:14px}
  .frame{
    background:#f6f6f8; border:3px solid #6c50ff; border-radius:8px;
    padding:28px 24px; max-width:860px; margin:16px auto; position:relative;
    box-shadow:0 8px 30px rgba(17,16,50,.18);
  }
  .frame h2{ text-align:center; margin:0; line-height:1.35; color:#1f1f2f; }
  .frame h2 .line2{font-weight:800}
  .sheet{ margin-top:18px; background:#f6f6f8; border:1px solid #b6a8ff; border-radius:10px; padding:24px 22px; }
  .photos{display:grid; grid-template-columns: 240px 1fr 240px; gap:24px; align-items:start; margin-top:6px}
  .ph{
    position:relative;
    height:160px; border-radius:10px;
    background:var(--vio);
    display:flex; align-items:center; justify-content:center; font-weight:700; color:#3b2f77;
    overflow:hidden; width:100%;
  }
  .ph[data-has-img="true"]{
    background-size:cover;
    background-position:center;
    color:transparent;
  }
  .ph input[type="file"]{ display:none; }
  .ph .overlay{
    position:absolute; left:8px; bottom:8px;
    display:flex; gap:6px;
  }
  .tinybtn{
    font:inherit; font-weight:700; padding:6px 8px; border-radius:10px; cursor:pointer;
    border:2px solid #cfd2ff; background:#fff; color:#1b1b2f; font-size:12px;
  }
  .tinybtn.primary{ border-color:#2e1df7; background:#eae7ff; color:#2e1df7 }
  .name{ 
      display:flex; 
      flex-direction:column; 
      align-items:center; 
      justify-content:center; 
      height:160px; 
      padding-top:0; 
    }
  .name .big{font-size:20px; font-weight:700; letter-spacing:.02em; color:#111; text-align:center}
  .name .date{font-size:12.5px; color:#333}
  .facts{margin-top:18px; display:grid; grid-template-columns:1fr; gap:10px}
  .row{display:flex; gap:10px; align-items:baseline}
  .label{color:#333; font-weight:600; flex:0 0 240px; }
  .value{color:#111; flex:1}
  .muted{color:var(--muted); font-weight:600}
  .spacer{height:10px}
  .photos-extra { grid-column: 1 / -1; margin: 16px 0; display: flex; gap:20px; }
  .photo-row { flex:1; display: flex; align-items: center; gap:10px; margin:0; }
  .custombar{
    display:flex; gap:8px; align-items:center; justify-content:flex-start;
    margin-top:8px; margin-bottom:4px;
  }
  .microbtn{
    font:inherit; font-weight:700; padding:6px 10px; border-radius:10px; cursor:pointer;
    border:2px solid #cfd2ff; background:#fff; color:#1b1b2f;
  }
  .microbtn.primary{ border-color:#2e1df7; background:#eae7ff; color:#2e1df7 }
  .customform{ display:none; gap:8px; grid-template-columns:240px 1fr auto; align-items:center; margin:8px 0 2px }
  .customform input{
    width:100%; padding:8px 10px; border:1px solid #ddd; border-radius:10px; font-family:inherit;
  }
  .remove{
    border:0; background:transparent; color:#777; cursor:pointer; font-weight:800; font-size:18px;
    padding:0; margin:0; position:static; flex:none;
  }
  .remove:hover{ color:#c00 }
  .show{ display:grid !important; }
  .next{
    display:inline-flex; align-items:center; justify-content:center;
    padding:10px 16px; font-weight:700; border-radius:12px;
    border:2px solid #2e1df7; background:#eae7ff; text-decoration:none; color:#2e1df7;
    position:absolute; right:18px; bottom:14px;
  }
  .next:hover{background:#dcd6ff}
  footer.footerlinks{display:flex; gap:16px; justify-content:center; margin-top:22px}
  footer.footerlinks a{color:#fff; text-decoration:none; font-weight:600}
  footer.footerlinks a:hover{text-decoration:underline}
.sheet > h3.section {
  color: #111 !important;     /* oder #1f1f2f, je nachdem wie dunkel du es willst */
  margin: 28px 0 12px;        /* optional: etwas mehr Luft oben, sieht schöner aus */
}
  </style>
</head>
<body>
<iframe src="topnav.html" title="Navigation" class="topnav-embed"></iframe>
<!-- direkt UNTER dem <iframe src="topnav.html" ...> -->
<style>
  .topnav-embed.topnav-full{
    position:fixed; inset:0; width:100vw; height:100vh;
    z-index:9999; background:transparent; border:0;
  }
</style>
<script>
  (function(){
    const iframe = document.querySelector('.topnav-embed');
    window.addEventListener('message', (e)=>{
      if (e.data?.type === 'TOPNAV_AUTH_OPEN')  iframe.classList.add('topnav-full');
      if (e.data?.type === 'TOPNAV_AUTH_CLOSE') iframe.classList.remove('topnav-full');
    });
  })();
</script>

  <div class="container">
    <div class="frame">
      <h2 class="smallcaps">Vorschau unseres Abibuch-Editors<br><span class="line2">–<br>so könnte dein Abibuch aussehen:</span></h2>
      <div class="sheet">
        <div class="photos">
          <!-- AKTUELLES FOTO -->
          <label class="ph" id="photo-current" data-has-img="false" title="Klicken zum Bild hochladen">
            <input type="file" id="file-current" accept="image/*">
            <span>AKTUELLES FOTO</span>
            <div class="overlay">
              <button type="button" class="tinybtn primary" data-action="select" data-target="current">Bild wählen</button>
            </div>
          </label>
          <div class="name">
            <div class="big">Mulan<br>Mustermann</div>
            <div class="date">31.02.2008</div>
          </div>
          <!-- KINDERBILD -->
          <label class="ph" id="photo-child" data-has-img="false" title="Klicken zum Bild hochladen">
            <input type="file" id="file-child" accept="image/*">
            <span>KINDERBILD</span>
            <div class="overlay">
              <button type="button" class="tinybtn primary" data-action="select" data-target="child">Bild wählen</button>
            </div>
          </label>
        </div>

        <!-- Faktenliste -->
        <div class="facts" id="facts"><!-- per JS --></div>

        <!-- Editorleiste für FAKTEN -->
        <div class="custombar">
          <button class="microbtn primary" id="toggleCustom">+ Eigenes Feld</button>
          <div class="customform" id="customForm">
            <input id="cfLabel" type="text" placeholder="Feldtitel (z. B. Lieblingsessen)">
            <input id="cfValue" type="text" placeholder="Inhalt (z. B. Pizza)">
            <button class="microbtn primary" id="cfAdd">Hinzufügen</button>
          </div>
        </div>

        <h3 class="section"><br>Mitschüler Kommentare</h3>
        <div class="comments" id="comments"><!-- per JS --></div>

        <!-- Editorleiste für KOMMENTARE -->
        <div class="custombar" id="custombar-comments">
          <button class="microbtn primary" id="toggleCustomComments">+ Eigenes Feld</button>
          <div class="customform" id="customFormComments">
            <input id="cfLabelComments" type="text" placeholder="Feldtitel (z. B. Lieblingsessen)">
            <input id="cfValueComments" type="text" placeholder="Inhalt (z. B. Pizza)">
            <button class="microbtn primary" id="cfAddComments">Hinzufügen</button>
          </div>
        </div>
      </div>
    </div>
    <footer class="footerlinks">
      <a href="kontakt.html">Kontakt</a>
      <a href="impressum.html">Impressum</a>
      <a href="nutzungsbedingungen.html">Nutzungsbedingungen</a>
      <a href="datenschutz.html">Datenschutz</a>
      <a href="rechtliche-hinweise.html">Rechtliche Hinweise</a>
    </footer>
  </div>

  <script>
    const BASE_FIELDS = [
      { id: "leistungskurse", label: "Leistungskurse:", value: "Bio, Sport" },
      { id: "lieblingsfach", label: "Lieblingsfach:", value: "Bio, Sport" },
      { id: "hassfach", label: "Hassfach:", value: "alle anderen" },
      { id: "lieblingslehrer", label: "Lieblingslehrer:", value: "Frau Himmelmann" },
      { id: "hasslehrer", label: "Hasslehrer:", value: "Herr Bock" },
      { id: "sportart", label: "Meine Sportart:", value: "Pausenhofschlägerei" },
      { id: "beschaeftigung", label: "Lieblingsbeschäftigung im Unterricht:", value: "Nase popeln" },
      { id: "motivationslevel", label: "Motivationslevel in der Schule:", value: "unterirdisch, -2/10" },
      { id: "drei-dinge", label: "3 Dinge, ohne die ich die Schule nicht überlebt hätte:", value: "Zigarettenpause, Handy, Freunde" },
      { id: "als-lehrer", label: "Als Lehrer würde ich...", value: "den Beruf wechseln" },
      { id: "rat-fuenft", label: "Fünft-Klässlern würde ich raten...", value: "lieber einen Hauptschulabschluss zu machen" },
      { id: "bestes-erlebnis", label: "Bestes Schulerlebnis:", value: "eine Woche Hitzefrei in der zehnten Klasse" },
      { id: "dreier-worte-head", label: "Die ersten 3 Worte die mir einfallen, wenn ich ... höre:", value: "" },
      { id: "dreier-worte-schule", label: "Schule:", value: "boah ne ey" },
      { id: "dreier-worte-freunde", label: "Freunde:", value: "Schabernack letzte Reihe" },
      { id: "dreier-worte-alkohol", label: "Alkohol:", value: "gib die Flasche!" },
      { type: "photo", id: "fantasie-photo", labelText: "SO SIEHT DIE SCHULE IN MEINER FANTASIE AUS" },
      { type: "photo", id: "meme-photo", labelText: "DIESES MEME BESCHREIBT MEINE SCHULZEIT" },
      { id: "mein-vorbild", label: "Mein Vorbild:", value: "Mia Khalifa" },
      { id: "plan-nach-abi", label: "Plan nach dem Abi:", value: "erst mal chillen" },
      { id: "mein-traumberuf", label: "Mein Traumberuf:", value: "OnlyFans-Model" },
      { id: "in-zehn-jahren", label: "Da sehe ich mich in 10 Jahren:", value: "entspannt am Strand" },
      { id: "lotto-gewinn", label: "Wenn ich im Lotto gewinne, würde ich:", value: "ein Haus auf Hawaii kaufen" },
      { id: "autobiografie", label: "Titel meiner Autobiografie:", value: "es kann nur besser werden!" },
      { id: "abschluss", label: "Das möchte ich abschließend noch sagen:", value: "vielen Dank für die schöne Zeit und auf nimmer Wiedersehen" }
    ];

    const COMMENT_FIELDS = [
      { id: "comment1", label: "Beschreibe die Person in einem Wort:", value: "witzig, nett, überdreht, faul, bildhübsch, verpeilt, frech" },
      { id: "comment2", label: "Da sehe ich die Person in 10 Jahren:", value: "glücklich, am Strand mit Villa, reich, mit dem heißesten Partner" },
      { id: "comment3", label: "Das will ich dir noch mit auf den Weg geben:", value: "viel Glück bei allem was du machst, ohne dich wäre die Schule nur halb so witzig gewesen, danke" }
    ];

    const CUSTOM_KEY = "digitabiCustomFieldsV1";
    const CUSTOM_COMMENTS_KEY = "digitabiCustomCommentsV1";
    const DELETED_KEY = "digitabiDeletedBaseV1";
    const DELETED_COMMENTS_KEY = "digitabiDeletedCommentsV1";

    function loadCustom(){ try { return JSON.parse(localStorage.getItem(CUSTOM_KEY)) || []; } catch { return []; } }
    function saveCustom(list){ localStorage.setItem(CUSTOM_KEY, JSON.stringify(list)); }
    function loadCustomComments(){ try { return JSON.parse(localStorage.getItem(CUSTOM_COMMENTS_KEY)) || []; } catch { return []; } }
    function saveCustomComments(list){ localStorage.setItem(CUSTOM_COMMENTS_KEY, JSON.stringify(list)); }
    function loadDeleted(){ try { return new Set(JSON.parse(localStorage.getItem(DELETED_KEY)) || []); } catch { return new Set(); } }
    function saveDeleted(set){ localStorage.setItem(DELETED_KEY, JSON.stringify([...set])); }
    function loadDeletedComments(){ try { return new Set(JSON.parse(localStorage.getItem(DELETED_COMMENTS_KEY)) || []); } catch { return new Set(); } }
    function saveDeletedComments(set){ localStorage.setItem(DELETED_COMMENTS_KEY, JSON.stringify([...set])); }

    let customFields = loadCustom();
    let customComments = loadCustomComments();
    let deletedBase = loadDeleted();
    let deletedComments = loadDeletedComments();

    const IMG_KEY_CURRENT = "digitabiPhotoCurrentV1";
    const IMG_KEY_CHILD = "digitabiPhotoChildV1";
    function getImgKey(id) { return `digitabiPhoto_${id}V1`; }

    function setPhoto(el, dataUrl){
      if (!el) return;
      if (dataUrl){
        el.style.backgroundImage = `url('${dataUrl}')`;
        el.setAttribute("data-has-img", "true");
      }else{
        el.style.backgroundImage = "none";
        el.setAttribute("data-has-img", "false");
      }
    }

    function loadImages(){
      setPhoto(document.getElementById('photo-current'), localStorage.getItem(IMG_KEY_CURRENT));
      setPhoto(document.getElementById('photo-child'), localStorage.getItem(IMG_KEY_CHILD));
      BASE_FIELDS.forEach(f => {
        if (f.type === "photo") {
          setPhoto(document.getElementById(`photo-${f.id}`), localStorage.getItem(getImgKey(f.id)));
        }
      });
    }

    function handleFile(inputEl, key, targetEl){
      const file = inputEl.files?.[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        const dataUrl = reader.result;
        localStorage.setItem(key, dataUrl);
        setPhoto(targetEl, dataUrl);
      };
      reader.readAsDataURL(file);
    }

    const factsEl = document.getElementById("facts");
    const commentsEl = document.getElementById("comments");

    function rowBaseHTML(f){
      return `<div class="row"><button class="remove" data-type="base" data-id="${f.id}">x</button><div class="label">${f.label}</div><div class="value">${f.value}</div></div>`;
    }

    function rowPhotoHTML(f) {
      const photoId = `photo-${f.id}`;
      const fileId = `file-${f.id}`;
      return `
        <div class="photo-row">
          <button class="remove" data-type="base" data-id="${f.id}">x</button>
          <label class="ph" id="${photoId}" data-has-img="false">
            <input type="file" id="${fileId}" accept="image/*">
            <span>${f.labelText}</span>
            <div class="overlay">
              <button type="button" class="tinybtn primary" data-action="select" data-target="${f.id}">Bild wählen</button>
            </div>
          </label>
        </div>`;
    }

    function rowCustomHTML(f, i){
      return `<div class="row"><button class="remove" data-type="custom" data-i="${i}">x</button><div class="label">${f.label}</div><div class="value">${f.value}</div></div>`;
    }

    function renderFacts(){
      let html = "", inPhotos = false;
      for (const f of BASE_FIELDS){
        if (deletedBase.has(f.id)) continue;
        if (f.type === "photo") {
          if (!inPhotos) { html += '<div class="photos-extra">'; inPhotos = true; }
          html += rowPhotoHTML(f);
        } else {
          if (inPhotos) { html += '</div>'; inPhotos = false; }
          html += rowBaseHTML(f);
        }
        if (f.id === "dreier-worte-head") html += `<div class="spacer"></div>`;
      }
      if (inPhotos) html += '</div>';
      customFields.forEach((f,i) => html += rowCustomHTML(f,i));
      factsEl.innerHTML = html;
    }

    function rowCommentHTML(f){
      return `<div class="comment"><div class="row"><button class="remove" data-type="comment" data-id="${f.id}">x</button><div class="label">${f.label}</div><div class="value">${f.value}</div></div></div>`;
    }

    function rowCustomCommentHTML(f, i){
      return `<div class="comment"><div class="row"><button class="remove" data-type="custom-comment" data-i="${i}">x</button><div class="label">${f.label}</div><div class="value">${f.value}</div></div></div>`;
    }

    function renderComments(){
      let html = "";
      for (const f of COMMENT_FIELDS){
        if (deletedComments.has(f.id)) continue;
        html += rowCommentHTML(f);
      }
      customComments.forEach((f,i) => html += rowCustomCommentHTML(f,i));
      commentsEl.innerHTML = html;
    }

    renderFacts();
    renderComments();
    loadImages();

    // FAKTEN: + Eigenes Feld
    const toggleBtn = document.getElementById("toggleCustom");
    const formBox = document.getElementById("customForm");
    const addBtn = document.getElementById("cfAdd");
    const inLabel = document.getElementById("cfLabel");
    const inValue = document.getElementById("cfValue");

    toggleBtn.addEventListener("click", () => {
      toggleBtn.style.display = 'none';
      formBox.classList.add("show");
      inLabel.focus();
    });

    addBtn.addEventListener("click", () => {
      const label = inLabel.value.trim();
      const value = inValue.value.trim();
      if (!label || !value){ alert("Bitte Feldtitel und Inhalt eingeben."); return; }
      customFields.push({ label, value });
      saveCustom(customFields);
      inLabel.value = ""; inValue.value = "";
      formBox.classList.remove("show");
      toggleBtn.style.display = 'block';
      renderFacts();
    });

    // KOMMENTARE: + Eigenes Feld
    const toggleBtnComments = document.getElementById("toggleCustomComments");
    const formBoxComments = document.getElementById("customFormComments");
    const addBtnComments = document.getElementById("cfAddComments");
    const inLabelComments = document.getElementById("cfLabelComments");
    const inValueComments = document.getElementById("cfValueComments");

    toggleBtnComments.addEventListener("click", () => {
      toggleBtnComments.style.display = 'none';
      formBoxComments.classList.add("show");
      inLabelComments.focus();
    });

    addBtnComments.addEventListener("click", () => {
      const label = inLabelComments.value.trim();
      const value = inValueComments.value.trim();
      if (!label || !value){ alert("Bitte Feldtitel und Inhalt eingeben."); return; }
      customComments.push({ label, value });
      saveCustomComments(customComments);
      inLabelComments.value = ""; inValueComments.value = "";
      formBoxComments.classList.remove("show");
      toggleBtnComments.style.display = 'block';
      renderComments();
    });

    // Entfernen
    document.addEventListener("click", (e) => {
      const btn = e.target.closest(".remove"); if (!btn) return;
      const type = btn.dataset.type;
      if (type === "custom"){
        const i = parseInt(btn.dataset.i, 10);
        customFields.splice(i, 1);
        saveCustom(customFields);
        renderFacts();
      }
      if (type === "base"){
        deletedBase.add(btn.dataset.id);
        saveDeleted(deletedBase);
        renderFacts();
      }
      if (type === "comment"){
        deletedComments.add(btn.dataset.id);
        saveDeletedComments(deletedComments);
        renderComments();
      }
      if (type === "custom-comment"){
        const i = parseInt(btn.dataset.i, 10);
        customComments.splice(i, 1);
        saveCustomComments(customComments);
        renderComments();
      }
    });

    // Foto-Upload
    const currentLabel = document.getElementById('photo-current');
    const childLabel = document.getElementById('photo-child');
    const inputCurrent = document.getElementById('file-current');
    const inputChild = document.getElementById('file-child');

    factsEl.addEventListener('click', (e) => {
      const label = e.target.closest('.ph');
      if (label && !e.target.closest('.tinybtn')) {
        label.querySelector('input[type="file"]').click();
      }
    });

    currentLabel.addEventListener('click', (e) => { if (!e.target.closest('.tinybtn')) inputCurrent.click(); });
    childLabel.addEventListener('click', (e) => { if (!e.target.closest('.tinybtn')) inputChild.click(); });

    inputCurrent.addEventListener('change', () => handleFile(inputCurrent, IMG_KEY_CURRENT, currentLabel));
    inputChild.addEventListener('change', () => handleFile(inputChild, IMG_KEY_CHILD, childLabel));

    BASE_FIELDS.forEach(f => {
      if (f.type === "photo") {
        const input = document.getElementById(`file-${f.id}`);
        const label = document.getElementById(`photo-${f.id}`);
        if (input) input.addEventListener('change', () => handleFile(input, getImgKey(f.id), label));
      }
    });

    document.addEventListener('click', (e) => {
      const btn = e.target.closest('.tinybtn'); if (!btn) return;
      const action = btn.dataset.action;
      const target = btn.dataset.target;
      let key, node, inp;
      if (target === 'current') { key = IMG_KEY_CURRENT; node = currentLabel; inp = inputCurrent; }
      else if (target === 'child') { key = IMG_KEY_CHILD; node = childLabel; inp = inputChild; }
      else { key = getImgKey(target); node = document.getElementById(`photo-${target}`); inp = document.getElementById(`file-${target}`); }
      if (!node || !inp) return;
      if (action === 'select') inp.click();
      if (action === 'clear') { localStorage.removeItem(key); setPhoto(node, null); }
    });
  </script>
</body>
</html>
